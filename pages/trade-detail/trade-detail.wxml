<view class="container">
  <view class="page-header">
    <view class="page-title">交易详情</view>
    <view class="page-subtitle">查看交易记录详细信息</view>
  </view>
  
  <view class="trade-overview">
    <view class="stock-name">{{trade.stockName}}</view>
    <view class="stock-code">{{trade.stockCode}}</view>
    <view class="badge-container">
      <view class="trade-type-badge badge-{{trade.type}}">{{trade.type === 'buy' ? '买入' : '卖出'}}</view>
      <view class="market-type-badge">
        {{marketType}}
      </view>
      <view class="match-status-badge badge-{{trade.matchStatus || 'unmatched'}}">
        {{trade.matchStatus === 'matched' ? '已匹配' : '未匹配'}}
      </view>
    </view>
    <view class="trade-amount">¥{{trade.amount}}</view>
    <view wx:if="{{trade.profit !== undefined}}" class="trade-profit {{trade.profit >= 0 ? 'profit-positive' : 'profit-negative'}}">
      本次交易盈亏: ¥{{trade.profit}}
    </view>
  </view>
  
  <view class="trade-detail">
    <view class="detail-card">
      <view class="card-title">交易信息</view>
      <view class="detail-grid">
        <view class="detail-item">
          <text class="detail-label">交易类型</text>
          <text class="detail-value">{{trade.type === 'buy' ? '买入' : '卖出'}}</text>
        </view>
        
        <view class="detail-item">
          <text class="detail-label">交易价格</text>
          <text class="detail-value">¥{{trade.price}}</text>
        </view>
        
        <view class="detail-item">
          <text class="detail-label">交易数量</text>
          <text class="detail-value">{{trade.quantity}}</text>
        </view>
        
        <view class="detail-item">
          <text class="detail-label">交易时间</text>
          <text class="detail-value">{{trade.date}}</text>
        </view>
        
        <view class="detail-item">
          <text class="detail-label">匹配状态</text>
          <text class="detail-value">{{trade.matchStatus === 'matched' ? '已匹配' : '未匹配'}}</text>
        </view>
      </view>
    </view>
    
    <!-- 关联T账单信息 -->
    <view wx:if="{{trade.matchStatus === 'matched' && relatedTBill}}" class="detail-card">
      <view class="card-title">关联T账单</view>
      <view class="tbill-info" bindtap="navigateToTBill">
        <view class="tbill-row">
          <text class="tbill-label">T账单类型:</text>
          <text class="tbill-value">{{relatedTBill.tType === 'buySell' ? '先买后卖' : '先卖后买'}}</text>
        </view>
        <view class="tbill-row">
          <text class="tbill-label">盈利金额:</text>
          <text class="tbill-value {{relatedTBill.profit >= 0 ? 'profit-positive' : 'profit-negative'}}">¥{{relatedTBill.profit}}</text>
        </view>
        <view class="tbill-row">
          <text class="tbill-label">盈利率:</text>
          <text class="tbill-value {{relatedTBill.profitRate >= 0 ? 'profit-positive' : 'profit-negative'}}">{{relatedTBill.profitRate}}%</text>
        </view>
        <view class="tbill-link">点击查看T账单详情 ></view>
      </view>
    </view>
    
    <!-- 匹配详情 -->
    <view wx:if="{{trade.matches && trade.matches.length > 0}}" class="detail-card">
      <view class="card-title">匹配详情</view>
      <view wx:for="{{trade.matches}}" wx:key="index" class="match-item">
        <view wx:if="{{trade.type === 'sell'}}">
          <view class="match-row">
            <text>买入价格: ¥{{item.buyPrice}}</text>
            <text>{{item.buyDate}}</text>
          </view>
          <view class="match-row">
            <text>卖出价格: ¥{{item.sellPrice}}</text>
            <text>{{item.sellDate}}</text>
          </view>
        </view>
        <view wx:else>
          <view class="match-row">
            <text>买入价格: ¥{{item.buyPrice}}</text>
            <text>{{item.buyDate}}</text>
          </view>
          <view class="match-row">
            <text>卖出价格: ¥{{item.sellPrice}}</text>
            <text>{{item.sellDate}}</text>
          </view>
        </view>
        <view class="match-footer">
          <text>匹配数量: {{item.quantity}}</text>
          <text class="{{item.profit >= 0 ? 'profit-positive' : 'profit-negative'}}">盈亏: ¥{{item.profit}}</text>
        </view>
      </view>
    </view>
  </view>
  
  <view class="actions">
    <button wx:if="{{isEditable}}" class="btn-danger" bindtap="deleteTrade">删除记录</button>
    <view wx:else class="disabled-notice">
      <text class="notice-text">已匹配的交易记录不可编辑或删除</text>
    </view>
  </view>
</view>
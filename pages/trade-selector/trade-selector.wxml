<!--äº¤æ˜“è®°å½•é€‰æ‹©é¡µé¢-->
<view class="container">
  <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
  <view class="filter-section">
    <!-- æœç´¢æ¡† -->
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="æœç´¢è‚¡ç¥¨ä»£ç æˆ–åç§°" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
      />
      <view class="search-icon">ğŸ”</view>
      <view wx:if="{{searchKeyword}}" class="clear-icon" bindtap="onSearchClear">âœ•</view>
    </view>
    
    <!-- äº¤æ˜“ç±»å‹ç­›é€‰ -->
    <view class="filter-row">
      <text class="filter-label">äº¤æ˜“ç±»å‹ï¼š</text>
      <picker 
        class="filter-picker" 
        mode="selector" 
        range="{{tradeTypeOptions}}" 
        range-key="label"
        value="{{tradeTypeOptions.findIndex(item => item.value === tradeType)}}"
        bindchange="onTradeTypeChange"
      >
        <view class="picker-text">
          {{tradeTypeOptions.find(item => item.value === tradeType).label}}
        </view>
      </picker>
    </view>
    
    <!-- ç­›é€‰ä¿¡æ¯æ˜¾ç¤º -->
    <view wx:if="{{stockCode || quantityFilter > 0}}" class="filter-info">
      <text wx:if="{{stockCode}}" class="filter-tag">è‚¡ç¥¨: {{stockCode}}</text>
      <text wx:if="{{quantityFilter > 0}}" class="filter-tag">æ•°é‡: {{quantityFilter}}</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- äº¤æ˜“è®°å½•åˆ—è¡¨ -->
  <view wx:else class="trade-list">
    <view wx:if="{{filteredTrades.length === 0}}" class="empty-state">
      <view class="empty-icon">ğŸ“</view>
      <view class="empty-text">æš‚æ— å¯é€‰æ‹©çš„äº¤æ˜“è®°å½•</view>
      <view class="empty-hint">è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶</view>
    </view>
    
    <view wx:else>
      <view 
        wx:for="{{filteredTrades}}" 
        wx:key="_id"
        class="{{getTradeItemClass(item)}}"
        data-id="{{item._id}}"
        bindtap="onTradeSelect"
      >
        <!-- é€‰æ‹©çŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <view wx:if="{{selectionMode === 'multiple'}}" class="selection-indicator">
          <view class="checkbox {{isTradeSelected(item._id) ? 'checked' : ''}}">
            <text wx:if="{{isTradeSelected(item._id)}}" class="check-mark">âœ“</text>
          </view>
        </view>
        
        <!-- äº¤æ˜“ä¿¡æ¯ -->
        <view class="trade-info">
          <view class="trade-header">
            <view class="stock-info">
              <text class="stock-code">{{item.stockCode}}</text>
              <text class="stock-name">{{item.stockName}}</text>
            </view>
            <view class="trade-type {{item.type === 'buy' ? 'buy' : 'sell'}}">
              {{item.type === 'buy' ? 'ä¹°å…¥' : 'å–å‡º'}}
            </view>
          </view>
          
          <view class="trade-details">
            <view class="detail-row">
              <text class="detail-label">ä»·æ ¼ï¼š</text>
              <text class="detail-value">Â¥{{formatAmount(item.price)}}</text>
            </view>
            <view class="detail-row">
              <text class="detail-label">æ•°é‡ï¼š</text>
              <text class="detail-value">{{item.quantity}}</text>
            </view>
            <view class="detail-row">
              <text class="detail-label">é‡‘é¢ï¼š</text>
              <text class="detail-value">Â¥{{formatAmount(item.amount)}}</text>
            </view>
            <view class="detail-row">
              <text class="detail-label">æ—¥æœŸï¼š</text>
              <text class="detail-value">{{item.date}}</text>
            </view>
          </view>
        </view>
        
        <!-- é€‰æ‹©ç®­å¤´ï¼ˆå•é€‰æ¨¡å¼ï¼‰ -->
        <view wx:if="{{selectionMode === 'single'}}" class="select-arrow">
          <text class="arrow-icon">â€º</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ ï¼ˆå¤šé€‰æ¨¡å¼ï¼‰ -->
  <view wx:if="{{selectionMode === 'multiple'}}" class="bottom-actions">
    <view class="selected-count">
      å·²é€‰æ‹© {{selectedTrades.length}} é¡¹
    </view>
    <view class="action-buttons">
      <button class="cancel-btn" bindtap="onCancel">å–æ¶ˆ</button>
      <button 
        class="confirm-btn {{selectedTrades.length > 0 ? 'active' : 'disabled'}}" 
        bindtap="onConfirm"
      >
        {{confirmText}}
      </button>
    </view>
  </view>

  <!-- åˆ·æ–°æŒ‰é’® -->
  <view class="refresh-btn" bindtap="onRefresh">
    <text class="refresh-icon">â†»</text>
  </view>
</view>